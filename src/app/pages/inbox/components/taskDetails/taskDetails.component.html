<div class="widgets">
  <div class="row">
    <ba-card baCardClass="with-scroll" class="data-table-container">
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-6">
              <h2>Active States</h2>
            </div>
            <div class="col-md-6 text-right">
            </div>
          </div>
        </div>
        <br>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="conversation-tab" data-toggle="tab" href="#tabConversation" role="tab" aria-controls="flow"
              aria-expanded="true">Conversation</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="details-tab" data-toggle="tab" href="#tabDetails" role="tab" aria-controls="details">Details</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="flow-tab" data-toggle="tab" href="#tabFlow" role="tab" aria-controls="flow">Flow</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div role="tabpanel" class="tab-pane fade show active" id="tabConversation" aria-labelledby="conversation-tab">
            <div class="row">
              <ba-card class="col-md-6 col-sm-12" cardTitle="Episode Details">
                <form style="max-height: 400px; overflow:scroll">
                  <!-- <div *ngIf="selectedEpisode && selectedEpisode._score" class="form-group">
                      <label>Score</label>
                      <input class="form-control" placeholder="Score" disabled="disabled" value="{{selectedEpisode._score}}" />
                    </div> -->
                  <!-- <div *ngIf="selectedEpisode && selectedEpisode._id" class="form-group">
                      <label>Id</label>
                      <input class="form-control" placeholder="Id" disabled="disabled" value="{{selectedEpisode._id}}" />
                    </div> -->
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.status" class="form-group">
                    <label>Status</label>
                    <input class="form-control" placeholder="Status" disabled="disabled" value="{{selectedEpisode._source.status}}" />
                  </div>
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.intents && selectedEpisode._source.intents.length > 0"
                    class="form-group">
                    <label>Intents</label>
                    <select multiple class="form-control" disabled="disabled">
                      <option *ngFor="let intent of selectedEpisode._source.intents">{{intent.intentName}}</option>
                    </select>
                  </div>
                  <!-- <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.name" class="form-group">
                      <label>Name</label>
                      <input class="form-control" placeholder="Name" disabled="disabled" value="{{selectedEpisode._source.name}}" />
                    </div> -->
                  <!-- <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.conversationId" class="form-group">
                      <label>Conversation Id</label>
                      <input class="form-control" placeholder="Conversation Id" disabled="disabled" value="{{selectedEpisode._source.conversationId}}"
                      />
                    </div> -->
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.entities && selectedEpisode._source.entities.length > 0"
                    class="form-group">
                    <label>Entities</label>
                    <select multiple class="form-control" disabled="disabled">
                      <option *ngFor="let entity of selectedEpisode._source.entities">{{entity}}</option>
                    </select>
                  </div>
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.mode" class="form-group">
                    <label>Mode</label>
                    <input class="form-control" placeholder="Mode" disabled="disabled" value="{{selectedEpisode._source.mode}}" />
                  </div>
                  <!-- <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.lastEpisodeStatus" class="form-group">
                      <label>Last Episode Status</label>
                      <input class="form-control" placeholder="Last Episode Status" disabled="disabled" value="{{selectedEpisode._source.lastEpisodeStatus}}"
                      />
                    </div> -->
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.startTime" class="form-group">
                    <label>Start Time</label>
                    <input class="form-control" placeholder="Start Time" disabled="disabled" value="{{selectedEpisode._source.startTime | date: 'dd/MM/y, h:mm:ss a'}}"
                    />
                  </div>
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.endTime" class="form-group">
                    <label>End Time</label>
                    <input class="form-control" placeholder="End Time" disabled="disabled" value="{{selectedEpisode._source.endTime | date: 'dd/MM/y, h:mm:ss a'}}"
                    />
                  </div>
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.goalStatus" class="form-group">
                    <label>Goal Status</label>
                    <input class="form-control" placeholder="Goal Status" disabled="disabled" value="{{selectedEpisode._source.goalStatus}}"
                    />
                  </div>
                  <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.goals && selectedEpisode._source.goals.length > 0"
                    class="form-group">
                    <label>Goals</label>
                    <select multiple class="form-control" disabled="disabled">
                      <option *ngFor="let goal of selectedEpisode._source.goals">{{goal.goalName}}</option>
                    </select>
                  </div>
                </form>
              </ba-card>

              <ba-card baCardClass="with-scroll" class="data-table-container col-md-6 col-sm-12" cardTitle="Conversation">
                <form style="max-height: 400px; overflow:scroll">
                  <thead>
                    <th style="width: 50%"></th>
                    <th style="width: 50%"></th>
                  </thead>
                  <tbody *ngFor="let message of chatMessageList">
                    <tr *ngIf="message.messageFrom === 'auto'">
                      <td align="left" style="width: 50%">
                        <div class="talk-bubble tri-right round top-left" style="background-color: #E4E4E4">
                          <div class="talktext">
                            <div [innerHTML]="message.inputText"></div>
                          </div>
                        </div>
                      </td>
                      <td></td>
                    </tr>
                    <tr *ngIf="message.messageFrom === 'user'">
                      <td></td>
                      <td align="right" style="width: 50%">
                        <div class="talk-bubble tri-right round top-right" style="background-color: #B9F1FB">
                          <div class="talktext">
                            <p>{{message.inputText}}</p>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </form>
              </ba-card>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane fade" id="tabDetails" aria-labelledby="details-tab">
            <form class="row form-inline">
              <div class="form-group col-md-12 alert-danger" style="margin-bottom: 10px;" *ngIf="responseError && responseError.length > 0" [innerHTML]="responseError"></div>

              <div class="form-group col-md-3 col-sm-6" style="margin-bottom: 10px;" *ngFor="let dataPoint of dataPoints; let index = index">
                <label *ngIf="index % 2 === 0 && dataPoint.dataType !== 'ANY'">{{dataPoint.dataPointLabel}}</label>
                
                <input *ngIf="index % 2 === 1 && (dataPoint.dataType === '' || dataPoint.dataType === 'STRING')" type="text" class="form-control col-md-12 col-sm-12"
                  [title]="dataPoint.description" [placeholder]="dataPoint.description" [value]="dataPoint.value" (input)="dataPoint.value = $event.target.value"
                />

                <input *ngIf="index % 2 === 1 && dataPoint.dataType === 'NUMBER'" type="number" class="form-control col-md-12 col-sm-12"
                [title]="dataPoint.description" [placeholder]="dataPoint.description" [value]="dataPoint.value" (input)="dataPoint.value = $event.target.value"
                  onkeypress="return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57"
                />

                <select *ngIf="index % 2 === 1 && dataPoint.dataType === 'BOOLEAN'" class="selectpicker form-control col-md-12 col-sm-12"
                  [title]="dataPoint.description" [ngModel]="dataPoint.value" [ngModelOptions]="{standalone: true}"
                  (ngModelChange)="dataPoint.value = $event">
                  <option [ngValue]="true">True</option>
                  <option [ngValue]="false">False</option>
                </select>

                <select *ngIf="index % 2 === 1 && dataPoint.dataType === 'SINGLE_SELECT'" class="selectpicker form-control col-md-12 col-sm-12"
                  [title]="dataPoint.description" [ngModel]="dataPoint.value" [ngModelOptions]="{standalone: true}"
                  (ngModelChange)="dataPoint.value = $event">
                  <option *ngFor="let choice of dataPoint.inputSource" [ngValue]="choice">{{choice}}</option>
                </select>

                <select *ngIf="index % 2 === 1 && dataPoint.dataType === 'MULTI_SELECT'" multiple="true" class="selectpicker form-control col-md-12 col-sm-12"
                  [title]="dataPoint.description" [ngModel]="dataPoint.value" [ngModelOptions]="{standalone: true}"
                  (ngModelChange)="dataPoint.value = $event">
                  <option *ngFor="let choice of dataPoint.inputSource" [ngValue]="choice">{{choice}}</option>
                </select>

                <tag-input *ngIf="index % 2 === 1 && dataPoint.dataType === 'ARRAY'" class="custom-input-tag-border form-control col-md-12 col-sm-12"
                  [title]="dataPoint.description" [(ngModel)]="dataPoint.value" name="value" [modelAsStrings]="true" [editable]="true" [separatorKeys]="[32]"
                  [placeholder]="'+' + dataPoint.dataPointLabel + ' (Enter separated)'" [secondaryPlaceholder]="'Enter ' + dataPoint.dataPointName + ' (Enter separated)'"
                  theme="minimal">
                </tag-input>
              </div>
            </form>

            <form>
              <button *ngIf="selectedState.statusCd !== 'CLOSED'" type="button" class="btn btn-primary" (click)="updateFlow()">
                Update Flow
              </button>
              <div class="ln_solid"></div>
            </form>
          </div>
          <div role="tabpanel" class="tab-pane fade" id="tabFlow" aria-labelledby="flow-tab">
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div id="editorGrid" class="col-md-12 col-sm-12 col-xs-12" style="height:68vh;overflow:hidden;margin-bottom:5px;border-style:solid;border-color:#1C2B36;"></div>
            </div>
          </div>
        </div>
      </div>
    </ba-card>
  </div>
</div>

<div class="modal fade" id="successModal" tabindex="-1" role="dialog" attr.aria-labelledby="successModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title" id="successModal">
          Success
        </h4>
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span>
          <span class="sr-only">Close</span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body" id="modal_body">
        Task completed successfully.
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer" id="modal_footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" (click)="onBack()">Dismiss</button>
      </div>
    </div>
  </div>
</div>