<div class="form-group row">
  <div class="col-md-12">
    <img *ngIf="loading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="
    />
    <input class="form-control" placeholder="Search conversations" type="text" [value]="searchQuery" (input)="onTextChange($event.target.value)">
  </div>
</div>

<div class="widgets">
  <div class="row">
    <ba-card baCardClass="with-scroll" class="data-table-container">
      <div class="panel panel-default">
        <table class="table table-striped" [mfData]="episodeList | universalDataFilter : filterQuery" #mf="mfDataTable" [mfRowsOnPage]="10"
          mfSortBy="_id">
          <thead>
            <tr>
              <th colspan="100%">
                Filter Results:
                <input class="form-control" [(ngModel)]="filterQuery" placeholder="Filter Query" />
              </th>
            </tr>
            <tr>
              <th>
                  <mfDefaultSorter by="_source.mode">Mode</mfDefaultSorter>
              </th>
              <th>
                  <mfDefaultSorter by="_source.entities">Entities</mfDefaultSorter>
              </th>
              <th>
                <mfDefaultSorter by="_source.startTime">Start Time</mfDefaultSorter>
              </th>
              <th>
                <mfDefaultSorter by="_source.endTime">End Time</mfDefaultSorter>
              </th>
              <th>
                <mfDefaultSorter by="_source.status">Status</mfDefaultSorter>
              </th>
              <th>
                <mfDefaultSorter by="_source.goalStatus">Goal Status</mfDefaultSorter>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let episode of mf.data" (click)="onSelect(episode)" data-toggle="modal" data-target="#detailsModal">
              <td>{{episode._source.mode}}</td>
              <td>{{arrayToString(episode._source.entities)}}</td>
              <td>{{episode._source.startTime | date:'dd/MM/y, h:mm:ss a'}}</td>
              <td>{{episode._source.endTime | date:'dd/MM/y, h:mm:ss a'}}</td>
              <td>{{episode._source.status}}</td>
              <td>{{episode._source.goalStatus}}</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="100%">
                <mfBootstrapPaginator [rowsOnPageSet]="[5,10,25,50,100]"></mfBootstrapPaginator>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </ba-card>
  </div>
</div>


<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" attr.aria-labelledby="detailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" style="max-width: 90%">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header" style="background: #F0F3F4">
        <h4 class="modal-title" id="detailsModalLabel">
          Task - Details
        </h4>
        <button type="button" class="close" data-dismiss="modal">
              <span aria-hidden="true">&times;</span>
              <span class="sr-only">Close</span>
            </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body" style="background: #F0F3F4">
        <div class="row">
          <ba-card class="col-md-6 col-sm-12" cardTitle="Episode Details">
            <form style="max-height: 400px; overflow:scroll">
              <div *ngIf="selectedEpisode && selectedEpisode._score" class="form-group">
                <label>Score</label>
                <input class="form-control" placeholder="Score" disabled="disabled" value="{{selectedEpisode._score}}" />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._id" class="form-group">
                <label>Id</label>
                <input class="form-control" placeholder="Id" disabled="disabled" value="{{selectedEpisode._id}}" />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.status" class="form-group">
                <label>Status</label>
                <input class="form-control" placeholder="Status" disabled="disabled" value="{{selectedEpisode._source.status}}" />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.intents && selectedEpisode._source.intents.length > 0"
                class="form-group">
                <label>Intents</label>
                <select multiple class="form-control" disabled="disabled">
                    <option *ngFor="let intent of selectedEpisode._source.intents">{{intent.intentName}}</option>
                  </select>
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.name" class="form-group">
                <label>Name</label>
                <input class="form-control" placeholder="Name" disabled="disabled" value="{{selectedEpisode._source.name}}" />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.conversationId" class="form-group">
                <label>Conversation Id</label>
                <input class="form-control" placeholder="Conversation Id" disabled="disabled" value="{{selectedEpisode._source.conversationId}}"
                />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.entities && selectedEpisode._source.entities.length > 0"
                class="form-group">
                <label>Entities</label>
                <select multiple class="form-control" disabled="disabled">
                      <option *ngFor="let entity of selectedEpisode._source.entities">{{entity}}</option>
                    </select>
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.mode" class="form-group">
                <label>Mode</label>
                <input class="form-control" placeholder="Mode" disabled="disabled" value="{{selectedEpisode._source.mode}}" />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.lastEpisodeStatus" class="form-group">
                <label>Last Episode Status</label>
                <input class="form-control" placeholder="Last Episode Status" disabled="disabled" value="{{selectedEpisode._source.lastEpisodeStatus}}"
                />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.startTime" class="form-group">
                <label>Start Time</label>
                <input class="form-control" placeholder="Start Time" disabled="disabled" value="{{selectedEpisode._source.startTime | date: 'dd/MM/y, h:mm:ss a'}}"
                />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.endTime" class="form-group">
                <label>End Time</label>
                <input class="form-control" placeholder="End Time" disabled="disabled" value="{{selectedEpisode._source.endTime | date: 'dd/MM/y, h:mm:ss a'}}"
                />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.goalStatus" class="form-group">
                <label>Goal Status</label>
                <input class="form-control" placeholder="Goal Status" disabled="disabled" value="{{selectedEpisode._source.goalStatus}}"
                />
              </div>
              <div *ngIf="selectedEpisode && selectedEpisode._source && selectedEpisode._source.goals && selectedEpisode._source.goals.length > 0"
                class="form-group">
                <label>Goals</label>
                <select  multiple class="form-control" disabled="disabled">
                      <option *ngFor="let goal of selectedEpisode._source.goals">{{goal.goalName}}</option>
                </select>
              </div>
            </form>
          </ba-card>

          <ba-card baCardClass="with-scroll" class="data-table-container col-md-6 col-sm-12" cardTitle="Conversation">
            <form style="max-height: 400px; overflow:scroll">
              <thead>
                <th style="width: 50%"></th>
                <th style="width: 50%"></th>
              </thead>
              <tbody *ngFor="let message of chatMessageList">
                <tr *ngIf="message.messageFrom === 'auto'">
                  <td align="left" style="width: 50%">
                    <div class="talk-bubble tri-right round top-left" style="background-color: #E4E4E4">
                      <div class="talktext">
                        <p>{{message.inputText}}</p>
                      </div>
                    </div>
                  </td>
                  <td></td>
                </tr>
                <tr *ngIf="message.messageFrom === 'user'">
                  <td></td>
                  <td align="right" style="width: 50%">
                    <div class="talk-bubble tri-right round top-right" style="background-color: #B9F1FB">
                      <div class="talktext">
                        <p>{{message.inputText}}</p>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </form>
          </ba-card>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer" id="settingsModalFooter" style="background: #F0F3F4">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!-- <button type="submit" class="btn btn-success" (click)="save()">Submit</button> -->
      </div>
    </div>
  </div>
</div>